<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment</title>
    <style>
        /* CSS Reset & Base Styles */
        :root {
            --primary: #d81b60;
            --secondary: #ad1457;
            --accent: #ff80ab;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --spiritual: #6a5acd;
            --book-cover: #f5e6ca;
            --page-color: #fff9e6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #fff5f7;
            color: var(--dark);
            line-height: 1.6;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Flag_of_Cambodia.svg/1200px-Flag_of_Cambodia.svg.png');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        
        /* Overlay to make content readable */
        .container {
            background-color: rgba(85, 50, 50, 0.9);
            border-radius: 10px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 0 20px rgba(241, 239, 239, 0.2);
        }
        
        /* Logo styles */
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid gold;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        /* Welcome message */
        .welcome-message {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid gold;
        }
        
        /* Rest of your existing CSS remains the same */
        /* Auth Background Section */
        .auth-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .auth-container {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .auth-container h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .auth-btn {
            padding: 12px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-btn.login {
            background-color: var(--primary);
            color: white;
            border: none;
        }
        
        .auth-btn.login:hover {
            background-color: var(--secondary);
        }
        
        .auth-btn.register {
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .auth-btn.register:hover {
            background-color: #fff5f7;
        }
        
        .auth-btn.skip {
            background-color: transparent;
            color: var(--gray);
            border: none;
            text-decoration: underline;
        }
        
        .auth-btn.skip:hover {
            color: var(--dark);
        }
        
        /* Hide auth background when user is logged in */
        .auth-background.hidden {
            display: none;
        }

        /* Layout Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-bottom: 2px solid gold;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        nav ul li a:hover {
            color: gold;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        nav ul li a.active {
            color: gold;
            font-weight: bold;
            border-bottom: 2px solid gold;
        }
        
        .auth-buttons button {
            margin-left: 10px;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .login-btn {
            background-color: transparent;
            color: white;
            border: 1px solid white;
        }
        
        .login-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .register-btn {
            background-color: var(--accent);
            color: var(--dark);
        }
        
        .register-btn:hover {
            background-color: #ff94b8;
        }
        
        /* Search Bar Styles */
        .search-container {
            position: relative;
            display: flex;
            margin: 1rem 0;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .search-btn {
            padding: 10px 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .search-btn:hover {
            background-color: var(--secondary);
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 0 0 4px 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        
        .search-results.show {
            display: block;
        }
        
        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .search-result-item:hover {
            background-color: #f9f9f9;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        /* Main Content Styles */
        main {
            padding: 2rem 0;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }
        
        .sidebar {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: fit-content;
        }
        
        .sidebar h3 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar ul li {
            margin-bottom: 0.5rem;
        }
        
        .sidebar ul li a {
            color: var(--dark);
            text-decoration: none;
            display: block;
            padding: 8px 0;
            transition: color 0.3s;
        }
        
        .sidebar ul li a:hover {
            color: var(--primary);
        }
        
        .sidebar ul li a.active {
            color: var(--primary);
            font-weight: 500;
        }
        
        .main-content {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        /* Product Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 1.5rem;
        }
        
        .product-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: white;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .product-image {
            height: 180px;
            background-color: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .product-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .product-info {
            padding: 1rem;
        }
        
        .product-title {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .product-stock {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }
        
        .in-stock {
            color: var(--success);
        }
        
        .low-stock {
            color: var(--warning);
        }
        
        .out-of-stock {
            color: var(--danger);
        }
        
        .product-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .add-to-cart {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .add-to-cart:hover {
            background-color: var(--secondary);
        }
        
        .add-to-cart:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }
        
        .wishlist-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s;
        }
        
        .wishlist-btn:hover {
            color: var(--danger);
        }
        
        .wishlist-btn.active {
            color: var(--danger);
        }
        
        /* Cart Styles */
        .cart-items {
            margin-top: 1.5rem;
        }
        
        .cart-item {
            display: flex;
            border-bottom: 1px solid #eee;
            padding: 1rem 0;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            margin-right: 1rem;
        }
        
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: 500;
            margin-bottom: 0.3rem;
        }
        
        .cart-item-price {
            color: var(--primary);
            font-weight: 500;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            margin-right: 1rem;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            background-color: #f0f0f0;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-input {
            width: 40px;
            height: 30px;
            text-align: center;
            border: 1px solid #ddd;
            margin: 0 5px;
        }
        
        .remove-item {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .cart-summary {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .summary-total {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }
        
        .checkout-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1.5rem;
            transition: background-color 0.3s;
        }
        
        .checkout-btn:hover {
            background-color: #218838;
        }
        
        /* Forms */
        .form-container {
            max-width: 500px;
            margin: 0 auto;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn-primary {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
        }
        
        .form-footer {
            text-align: center;
            margin-top: 1.5rem;
        }
        
        .form-footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 500;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        /* Auth Required Modal */
        .auth-required-modal .modal-body {
            text-align: center;
            padding: 2rem;
        }
        
        .auth-required-modal .modal-body svg {
            width: 64px;
            height: 64px;
            fill: var(--primary);
            margin-bottom: 1rem;
        }

        /* Order Card Styles */
        .order-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .order-date {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .order-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .order-status.processing {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .order-status.shipped {
            background-color: #d4edda;
            color: #155724;
        }
        
        .order-status.delivered {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .order-status.cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .order-total {
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .order-items {
            border-top: 1px solid #eee;
            padding-top: 1rem;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .order-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
        }
        
        .cancel-order-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .cancel-order-btn:hover {
            background-color: #c82333;
        }
        
        .cancel-order-btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }
        
        /* Product Detail Modal */
        .product-detail-modal .modal-content {
            max-width: 800px;
        }
        
        .product-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .product-detail-image {
            background-color: #f9f9f9;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .product-detail-image img {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
        }
        
        .product-detail-info {
            display: flex;
            flex-direction: column;
        }
        
        .product-detail-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .product-detail-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .product-detail-description {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .product-detail-stock {
            margin-bottom: 1.5rem;
        }
        
        .product-detail-actions {
            margin-top: auto;
            display: flex;
            gap: 1rem;
        }
        
        .product-detail-actions .add-to-cart {
            flex: 1;
        }

        /* Library Styles */
        .library-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: #f9f9f9;
        }
        
        .library-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .library-card h3 {
            color: var(--spiritual);
            margin-bottom: 0.5rem;
        }
        
        .library-card p {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .library-card .author {
            font-style: italic;
            color: var(--gray);
        }
        
        .read-btn {
            background-color: var(--spiritual);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            transition: background-color 0.3s;
        }
        
        .read-btn:hover {
            background-color: #5a4acd;
        }
        
        /* Book Reader Styles */
        .book-reader-modal .modal-content {
            max-width: 900px;
            padding: 0;
            background-color: transparent;
            box-shadow: none;
        }
        
        .book-container {
            display: flex;
            position: relative;
            height: 600px;
            perspective: 3000px;
        }
        
        .book {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s;
        }
        
        .book-cover {
            position: absolute;
            width: 50%;
            height: 100%;
            background-color: var(--book-cover);
            border-radius: 5px 15px 15px 5px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            transform-origin: left center;
            transform: rotateY(0deg);
            transition: transform 1s;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            color: #333;
        }
        
        .book-cover img {
            max-width: 80%;
            max-height: 60%;
            margin-bottom: 1rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .book-cover h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--spiritual);
        }
        
        .book-cover .author {
            font-style: italic;
            margin-bottom: 1rem;
        }
        
        .book-cover .start-reading {
            background-color: var(--spiritual);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
        }
        
        .book-page {
            position: absolute;
            width: 50%;
            height: 100%;
            left: 50%;
            background-color: var(--page-color);
            padding: 2rem;
            overflow-y: auto;
            box-sizing: border-box;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        
        .book-page h3 {
            color: var(--spiritual);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }
        
        .book-page p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .book-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 20;
        }
        
        .book-controls button {
            background-color: var(--spiritual);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .book-controls button:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }
        
        .page-number {
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
            background-color: rgba(0,0,0,0.5);
            border-radius: 4px;
        }
        
        /* Book Detail Modal */
        .book-detail-modal .modal-content {
            max-width: 800px;
        }
        
        .book-detail {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }
        
        .book-cover-preview {
            background-color: var(--book-cover);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            height: 400px;
        }
        
        .book-cover-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .book-content-preview {
            display: flex;
            flex-direction: column;
            height: 400px;
            overflow-y: auto;
        }
        
        .book-content-preview h2 {
            color: var(--spiritual);
            margin-bottom: 1rem;
        }
        
        .book-content-preview .author {
            font-style: italic;
            margin-bottom: 1rem;
            color: var(--gray);
        }
        
        .book-content-preview .description {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .book-content-preview .chapter {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .book-content-preview .chapter:last-child {
            border-bottom: none;
        }
        
        .book-content-preview .chapter h3 {
            color: var(--spiritual);
            margin-bottom: 0.5rem;
        }
        
        /* About Section Styles */
        #about-page {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .about-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .about-content {
            margin-bottom: 2rem;
            line-height: 1.8;
        }
        
        .nerves-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 2rem;
        }
        
        .nerve-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .nerve-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .nerve-image {
            height: 200px;
            background-color: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .nerve-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .nerve-info {
            padding: 1rem;
            text-align: center;
        }
        
        .nerve-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            gap: 10px;
        }
        
        .page-btn {
            padding: 8px 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .page-btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            
            .auth-buttons {
                margin-top: 1rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .product-detail {
                grid-template-columns: 1fr;
            }
            
            .book-detail {
                grid-template-columns: 1fr;
            }
            
            .book-cover-preview {
                height: 300px;
            }
            
            .book-content-preview {
                height: auto;
                max-height: 300px;
            }
            
            .book-container {
                height: 400px;
            }
            
            .book-cover, .book-page {
                width: 100%;
            }
            
            .book-cover {
                border-radius: 5px;
            }
            
            .nerves-gallery {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .mt-3 {
            margin-top: 1.5rem;
        }
        
        .mb-3 {
            margin-bottom: 1.5rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Language Selector */
        .language-selector {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .language-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .language-btn:hover {
            transform: scale(1.1);
        }
        
        .language-dropdown {
            position: absolute;
            bottom: 60px;
            right: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            overflow: hidden;
            display: none;
        }
        
        .language-dropdown.show {
            display: block;
        }
        
        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .language-option:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <!-- Auth Background Section -->
    <div class="auth-background" id="authBackground">
        <div class="auth-container">
            <h2>Welcome to Phi Sma KO</h2>
            <p>Please login or register to access our beauty products</p>
            
            <div class="auth-buttons">
                <button class="auth-btn login" onclick="navigateTo('login'); document.getElementById('authBackground').classList.add('hidden')">Login</button>
                <button class="auth-btn register" onclick="navigateTo('register'); document.getElementById('authBackground').classList.add('hidden')">Register</button>
                <button class="auth-btn skip" onclick="document.getElementById('authBackground').classList.add('hidden')">Continue as Guest</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Flag_of_Cambodia.svg/1200px-Flag_of_Cambodia.svg.png" alt="Cambodian Flag" class="logo-img">
                <span>Phi Sma KO</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="products">Products</a></li>
                    <li><a href="#" class="nav-link" data-page="library">Library</a></li>
                    <li><a href="#" class="nav-link" data-page="cart">Cart</a></li>
                    <li><a href="#" class="nav-link" data-page="orders">Orders</a></li>
                    <li><a href="#" class="nav-link" data-page="about">About</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <button class="login-btn" id="loginBtn">Login</button>
                <button class="register-btn" id="registerBtn">Register</button>
                <button class="login-btn hidden" id="logoutBtn">Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Home Page -->
        <div id="home-page" class="page-content">
            <div class="welcome-message">
                <h1>Welcome to Phi Sam KO</h1>
                <p>Discover the beauty of Cambodia through our premium products and spiritual wisdom</p>
            </div>
            
            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="Search for makeup, jewelry, and more...">
                <button class="search-btn" id="searchBtn">Search</button>
                <div class="search-results" id="searchResults"></div>
            </div>
            
            <div class="products-grid mt-3">
                <!-- Featured products will be loaded here by JavaScript -->
            </div>
        </div>

        <!-- Products Page -->
        <div id="products-page" class="page-content hidden">
            <h1>Our Beauty Products</h1>
            <p>Browse our extensive catalog of 1000 beauty items.</p>
            
            <div class="search-container mb-3">
                <input type="text" id="products-search-input" class="search-input" placeholder="Search for makeup, jewelry, and more...">
                <button class="search-btn" id="products-search-btn">Search</button>
                <div class="search-results" id="products-search-results"></div>
            </div>
            
            <div class="filters mb-3">
                <select id="category-filter" class="form-control">
                    <option value="">All Categories</option>
                    <!-- Categories will be loaded by JavaScript -->
                </select>
            </div>
            
            <div class="products-grid">
                <!-- All products will be loaded here by JavaScript -->
            </div>
        </div>

        <!-- Library Page -->
        <div id="library-page" class="page-content hidden">
            <h1>Buddhist Wisdom Library</h1>
            <p>Explore our collection of 100 Buddhist books for spiritual growth and mindfulness.</p>
            
            <div class="search-container mb-3">
                <input type="text" id="library-search-input" class="search-input" placeholder="Search for books, authors, or topics...">
                <button class="search-btn" style="background-color: var(--spiritual);" id="library-search-btn">Search</button>
                <div class="search-results" id="library-search-results"></div>
            </div>
            
            <div class="library-list">
                <!-- Buddhist books will be loaded here by JavaScript -->
            </div>
        </div>

        <!-- Cart Page -->
        <div id="cart-page" class="page-content hidden">
            <h1>Your Beauty Cart</h1>
            
            <div class="cart-items">
                <!-- Cart items will be loaded here by JavaScript -->
                <div class="text-center mt-3" id="empty-cart-message">
                    <p>Your cart is empty</p>
                    <button class="btn-primary mt-3" onclick="navigateTo('products')">Browse Products</button>
                </div>
            </div>
            
            <div class="cart-summary hidden" id="cart-summary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Shipping:</span>
                    <span id="shipping">$5.99</span>
                </div>
                <div class="summary-row">
                    <span>Tax:</span>
                    <span id="tax">$0.00</span>
                </div>
                <div class="summary-row summary-total">
                    <span>Total:</span>
                    <span id="total">$0.00</span>
                </div>
                <button class="checkout-btn" id="checkoutBtn">Proceed to Checkout</button>
            </div>
        </div>

        <!-- Orders Page -->
        <div id="orders-page" class="page-content hidden">
            <h1>Your Orders</h1>
            
            <div class="orders-list mt-3">
                <!-- Orders will be loaded here by JavaScript -->
                <div class="text-center" id="no-orders-message">
                    <p>You haven't placed any orders yet</p>
                    <button class="btn-primary mt-3" onclick="navigateTo('products')">Browse Products</button>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <div id="about-page" class="page-content hidden">
            <div class="about-header">
                <h1>About Phi Sam KO</h1>
                <p>Discover the Beauty and Spirit of Cambodia</p>
            </div>
            
            <div class="about-content">
                <h2>Our Mission</h2>
                <p>Phi Sam KO is dedicated to preserving and promoting the rich cultural heritage of Cambodia through our premium beauty products and spiritual wisdom. We combine traditional Cambodian knowledge with modern techniques to bring you authentic experiences.</p>
                
                <h2 class="mt-3">Cambodian Nerves Collection</h2>
                <p>Cambodia is home to a unique system of traditional medicine that recognizes 1,336 nerves in the human body. These nerves are central to traditional healing practices and are deeply connected to spiritual beliefs.</p>
                <p>Below is our comprehensive collection showcasing these nerves with detailed illustrations and descriptions.</p>
            </div>
            
            <div class="nerves-gallery" id="nervesGallery">
                <!-- Nerves will be loaded here by JavaScript -->
            </div>
            
            <div class="pagination">
                <button class="page-btn" id="prevPageBtn">Previous</button>
                <span id="pageInfo">Page 1 of 67</span>
                <button class="page-btn" id="nextPageBtn">Next</button>
            </div>
        </div>

        <!-- Login Form -->
        <div id="login-page" class="page-content hidden">
            <div class="form-container">
                <h2 class="form-title">Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn-primary">Login</button>
                </form>
                <div class="form-footer">
                    <p>Don't have an account? <a href="#" onclick="navigateTo('register')">Register</a></p>
                </div>
            </div>
        </div>

        <!-- Register Form -->
        <div id="register-page" class="page-content hidden">
            <div class="form-container">
                <h2 class="form-title">Register</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="register-name">Full Name</label>
                        <input type="text" id="register-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Confirm Password</label>
                        <input type="password" id="register-confirm-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn-primary">Register</button>
                </form>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" onclick="navigateTo('login')">Login</a></p>
                </div>
            </div>
        </div>

        <!-- Checkout Page -->
        <div id="checkout-page" class="page-content hidden">
            <div class="form-container">
                <h2 class="form-title">Checkout</h2>
                <form id="checkoutForm">
                    <div class="form-group">
                        <label for="checkout-name">Full Name</label>
                        <input type="text" id="checkout-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="checkout-email">Email</label>
                        <input type="email" id="checkout-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="checkout-address">Shipping Address</label>
                        <textarea id="checkout-address" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="checkout-payment">Payment Method</label>
                        <select id="checkout-payment" class="form-control" required>
                            <option value="">Select payment method</option>
                            <option value="credit">Credit Card</option>
                            <option value="paypal">PayPal</option>
                            <option value="bank">Bank Transfer</option>
                        </select>
                    </div>
                    
                    <div class="order-summary mt-3">
                        <h3>Order Summary</h3>
                        <div id="checkout-items">
                            <!-- Order items will be loaded here by JavaScript -->
                        </div>
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="checkout-subtotal">$0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping:</span>
                            <span id="checkout-shipping">$5.99</span>
                        </div>
                        <div class="summary-row">
                            <span>Tax:</span>
                            <span id="checkout-tax">$0.00</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total:</span>
                            <span id="checkout-total">$0.00</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary mt-3">Place Order</button>
                </form>
            </div>
        </div>

        <!-- Order Confirmation Modal -->
        <div class="modal" id="orderConfirmationModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Order Confirmation</h3>
                    <button class="close-modal" onclick="closeModal('orderConfirmationModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="#28a745"/>
                        </svg>
                        <h3 class="mt-3">Thank you for your order!</h3>
                        <p>Your order has been placed successfully.</p>
                        <p>Order ID: <strong id="confirmation-order-id"></strong></p>
                        <p>Total: <strong id="confirmation-order-total"></strong></p>
                        <button class="btn-primary mt-3" onclick="closeModal('orderConfirmationModal'); navigateTo('orders')">View Orders</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auth Required Modal -->
        <div class="modal auth-required-modal" id="authRequiredModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Authentication Required</h3>
                    <button class="close-modal" onclick="closeModal('authRequiredModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v2h-2v-2zm0-12h2v10h-2V5z"/>
                    </svg>
                    <h3>Please Login or Register</h3>
                    <p>You need to be logged in to access this page.</p>
                    <div class="mt-3">
                        <button class="btn-primary" onclick="navigateTo('login'); closeModal('authRequiredModal')">Login</button>
                        <button class="btn-primary" style="background-color: var(--accent); margin-left: 10px;" onclick="navigateTo('register'); closeModal('authRequiredModal')">Register</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Detail Modal -->
        <div class="modal" id="productDetailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Product Details</h3>
                    <button class="close-modal" onclick="closeModal('productDetailModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="product-detail" id="productDetailContent">
                        <!-- Product details will be loaded here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Book Detail Modal -->
        <div class="modal book-detail-modal" id="bookDetailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Book Details</h3>
                    <button class="close-modal" onclick="closeModal('bookDetailModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="book-detail" id="bookDetailContent">
                        <!-- Book details will be loaded here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Book Reader Modal -->
        <div class="modal book-reader-modal" id="bookReaderModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Book Reader</h3>
                    <button class="close-modal" onclick="closeModal('bookReaderModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="book-container">
                        <div class="book" id="bookReader">
                            <div class="book-cover" id="bookCover">
                                <!-- Cover content will be loaded here -->
                            </div>
                            <div class="book-page" id="bookPage">
                                <!-- Page content will be loaded here -->
                            </div>
                        </div>
                        <div class="book-controls">
                            <button id="prevPageBtn">Previous</button>
                            <div class="page-number" id="pageNumber">1/1</div>
                            <button id="nextPageBtn">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Language Selector -->
    <div class="language-selector">
        <button class="language-btn" id="languageBtn">EN</button>
        <div class="language-dropdown" id="languageDropdown">
            <div class="language-option" data-lang="en">English</div>
            <div class="language-option" data-lang="es">Español</div>
            <div class="language-option" data-lang="fr">Français</div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let products = [];
        let categories = [];
        let books = [];
        let cart = [];
        let orders = [];
        let currentLanguage = 'en';
        let currentBook = null;
        let currentPage = 0;
        let nerves = [];
        let currentNervePage = 1;
        const nervesPerPage = 20;
        
        // Translations
        const translations = {
            en: {
                welcome: "Welcome to Phi Sam KO",
                description: "Discover the beauty of Cambodia through our premium products and spiritual wisdom",
                productsTitle: "Our Beauty Products",
                productsDescription: "Browse our extensive catalog of 1000 beauty items.",
                libraryTitle: "Buddhist Wisdom Library",
                libraryDescription: "Explore our collection of 100 Buddhist books for spiritual growth and mindfulness.",
                cartTitle: "Your Beauty Cart",
                emptyCart: "Your cart is empty",
                browseProducts: "Browse Products",
                subtotal: "Subtotal:",
                shipping: "Shipping:",
                tax: "Tax:",
                total: "Total:",
                checkout: "Proceed to Checkout",
                ordersTitle: "Your Orders",
                noOrders: "You haven't placed any orders yet",
                loginTitle: "Login",
                registerTitle: "Register",
                fullName: "Full Name",
                email: "Email",
                password: "Password",
                confirmPassword: "Confirm Password",
                alreadyHaveAccount: "Already have an account?",
                dontHaveAccount: "Don't have an account?",
                login: "Login",
                register: "Register",
                checkoutTitle: "Checkout",
                shippingAddress: "Shipping Address",
                paymentMethod: "Payment Method",
                selectPayment: "Select payment method",
                creditCard: "Credit Card",
                paypal: "PayPal",
                bankTransfer: "Bank Transfer",
                orderSummary: "Order Summary",
                placeOrder: "Place Order",
                orderConfirmation: "Order Confirmation",
                thankYou: "Thank you for your order!",
                orderPlaced: "Your order has been placed successfully.",
                orderId: "Order ID:",
                viewOrders: "View Orders",
                searchPlaceholder: "Search for makeup, jewelry, and more...",
                bookSearchPlaceholder: "Search for books, authors, or topics...",
                allCategories: "All Categories",
                authRequired: "Please Login or Register",
                authRequiredMessage: "You need to be logged in to access this page.",
                addToCart: "Add to Cart",
                notEnoughStock: "Not enough stock available",
                outOfStock: "Out of stock",
                pleaseLoginToViewOrders: "Please login to view your orders",
                pleaseLoginToCheckout: "Please login to proceed with checkout",
                cartEmpty: "Your cart is empty",
                passwordsDontMatch: "Passwords do not match",
                productDetails: "Product Details",
                bookDetails: "Book Details",
                viewDetails: "View Details",
                readBook: "Read Book",
                order: "Order",
                cancelOrder: "Cancel Order",
                cancelOrderConfirm: "Are you sure you want to cancel this order?",
                orderCancelled: "Order has been cancelled",
                processing: "Processing",
                shipped: "Shipped",
                delivered: "Delivered",
                cancelled: "Cancelled",
                status: "Status:",
                quantity: "Quantity:",
                inStock: "In Stock",
                lowStock: "Low Stock",
                outOfStock: "Out of Stock",
                author: "Author:",
                pages: "Pages:",
                published: "Published:",
                description: "Description:",
                chapters: "Chapters:",
                readNow: "Read Now",
                closeBook: "Close Book",
                startReading: "Start Reading",
                previousPage: "Previous",
                nextPage: "Next",
                aboutTitle: "About Phi Sam KO",
                aboutSubtitle: "Discover the Beauty and Spirit of Cambodia",
                ourMission: "Our Mission",
                missionText: "Phi Sam KO is dedicated to preserving and promoting the rich cultural heritage of Cambodia through our premium beauty products and spiritual wisdom. We combine traditional Cambodian knowledge with modern techniques to bring you authentic experiences.",
                nervesCollection: "Cambodian Nerves Collection",
                nervesText: "Cambodia is home to a unique system of traditional medicine that recognizes 1,336 nerves in the human body. These nerves are central to traditional healing practices and are deeply connected to spiritual beliefs.",
                nerve: "Nerve",
                location: "Location",
                function: "Function",
                traditionalUse: "Traditional Use",
                page: "Page"
            },
            es: {
                welcome: "Bienvenido a Phi Sam KO",
                description: "Descubre la belleza de Camboya a través de nuestros productos premium y sabiduría espiritual",
                productsTitle: "Nuestros Productos de Belleza",
                productsDescription: "Explore nuestro extenso catálogo de 1000 artículos de belleza.",
                libraryTitle: "Biblioteca de Sabiduría Budista",
                libraryDescription: "Explore nuestra colección de 100 libros budistas para crecimiento espiritual y mindfulness.",
                cartTitle: "Tu Carrito de Belleza",
                emptyCart: "Tu carrito está vacío",
                browseProducts: "Ver Productos",
                subtotal: "Subtotal:",
                shipping: "Envío:",
                tax: "Impuesto:",
                total: "Total:",
                checkout: "Proceder al Pago",
                ordersTitle: "Tus Pedidos",
                noOrders: "No has realizado ningún pedido todavía",
                loginTitle: "Iniciar Sesión",
                registerTitle: "Registrarse",
                fullName: "Nombre Completo",
                email: "Correo Electrónico",
                password: "Contraseña",
                confirmPassword: "Confirmar Contraseña",
                alreadyHaveAccount: "¿Ya tienes una cuenta?",
                dontHaveAccount: "¿No tienes una cuenta?",
                login: "Iniciar Sesión",
                register: "Registrarse",
                checkoutTitle: "Pago",
                shippingAddress: "Dirección de Envío",
                paymentMethod: "Método de Pago",
                selectPayment: "Seleccionar método de pago",
                creditCard: "Tarjeta de Crédito",
                paypal: "PayPal",
                bankTransfer: "Transferencia Bancaria",
                orderSummary: "Resumen del Pedido",
                placeOrder: "Realizar Pedido",
                orderConfirmation: "Confirmación de Pedido",
                thankYou: "¡Gracias por tu pedido!",
                orderPlaced: "Tu pedido ha sido realizado con éxito.",
                orderId: "ID del Pedido:",
                viewOrders: "Ver Pedidos",
                searchPlaceholder: "Buscar maquillaje, joyería y más...",
                bookSearchPlaceholder: "Buscar libros, autores o temas...",
                allCategories: "Todas las Categorías",
                authRequired: "Por favor Inicia Sesión o Regístrate",
                authRequiredMessage: "Necesitas iniciar sesión para acceder a esta página.",
                addToCart: "Añadir al Carrito",
                notEnoughStock: "No hay suficiente stock disponible",
                outOfStock: "Agotado",
                pleaseLoginToViewOrders: "Por favor inicia sesión para ver tus pedidos",
                pleaseLoginToCheckout: "Por favor inicia sesión para proceder al pago",
                cartEmpty: "Tu carrito está vacío",
                passwordsDontMatch: "Las contraseñas no coinciden",
                productDetails: "Detalles del Producto",
                bookDetails: "Detalles del Libro",
                viewDetails: "Ver Detalles",
                readBook: "Leer Libro",
                order: "Pedido",
                cancelOrder: "Cancelar Pedido",
                cancelOrderConfirm: "¿Estás seguro de que quieres cancelar este pedido?",
                orderCancelled: "El pedido ha sido cancelado",
                processing: "Procesando",
                shipped: "Enviado",
                delivered: "Entregado",
                cancelled: "Cancelado",
                status: "Estado:",
                quantity: "Cantidad:",
                inStock: "En Stock",
                lowStock: "Stock Bajo",
                outOfStock: "Agotado",
                author: "Autor:",
                pages: "Páginas:",
                published: "Publicado:",
                description: "Descripción:",
                chapters: "Capítulos:",
                readNow: "Leer Ahora",
                closeBook: "Cerrar Libro",
                startReading: "Comenzar a Leer",
                previousPage: "Anterior",
                nextPage: "Siguiente",
                aboutTitle: "Acerca de Phi Sam KO",
                aboutSubtitle: "Descubre la Belleza y el Espíritu de Camboya",
                ourMission: "Nuestra Misión",
                missionText: "Phi Sam KO se dedica a preservar y promover el rico patrimonio cultural de Camboya a través de nuestros productos de belleza premium y sabiduría espiritual. Combinamos el conocimiento tradicional camboyano con técnicas modernas para ofrecerte experiencias auténticas.",
                nervesCollection: "Colección de Nervios Camboyanos",
                nervesText: "Camboya alberga un sistema único de medicina tradicional que reconoce 1,336 nervios en el cuerpo humano. Estos nervios son fundamentales para las prácticas de curación tradicional y están profundamente conectados con las creencias espirituales.",
                nerve: "Nervio",
                location: "Ubicación",
                function: "Función",
                traditionalUse: "Uso Tradicional",
                page: "Página"
            },
            fr: {
                welcome: "Bienvenue sur Phi Sam KO",
                description: "Découvrez la beauté du Cambodge à travers nos produits premium et notre sagesse spirituelle",
                productsTitle: "Nos Produits de Beauté",
                productsDescription: "Parcourez notre vaste catalogue de 1000 articles de beauté.",
                libraryTitle: "Bibliothèque de Sagesse Bouddhiste",
                libraryDescription: "Explorez notre collection de 100 livres bouddhistes pour la croissance spirituelle et la pleine conscience.",
                cartTitle: "Votre Panier Beauté",
                emptyCart: "Votre panier est vide",
                browseProducts: "Parcourir les Produits",
                subtotal: "Sous-total:",
                shipping: "Livraison:",
                tax: "Taxe:",
                total: "Total:",
                checkout: "Passer à la Caisse",
                ordersTitle: "Vos Commandes",
                noOrders: "Vous n'avez passé aucune commande pour le moment",
                loginTitle: "Connexion",
                registerTitle: "Inscription",
                fullName: "Nom Complet",
                email: "Email",
                password: "Mot de Passe",
                confirmPassword: "Confirmer le Mot de Passe",
                alreadyHaveAccount: "Vous avez déjà un compte?",
                dontHaveAccount: "Vous n'avez pas de compte?",
                login: "Connexion",
                register: "Inscription",
                checkoutTitle: "Paiement",
                shippingAddress: "Adresse de Livraison",
                paymentMethod: "Méthode de Paiement",
                selectPayment: "Sélectionner un mode de paiement",
                creditCard: "Carte de Crédit",
                paypal: "PayPal",
                bankTransfer: "Virement Bancaire",
                orderSummary: "Récapitulatif de la Commande",
                placeOrder: "Passer la Commande",
                orderConfirmation: "Confirmation de Commande",
                thankYou: "Merci pour votre commande!",
                orderPlaced: "Votre commande a été passée avec succès.",
                orderId: "Numéro de Commande:",
                viewOrders: "Voir les Commandes",
                searchPlaceholder: "Rechercher du maquillage, des bijoux et plus...",
                bookSearchPlaceholder: "Rechercher des livres, auteurs ou sujets...",
                allCategories: "Toutes les Catégories",
                authRequired: "Veuillez vous connecter ou vous inscrire",
                authRequiredMessage: "Vous devez être connecté pour accéder à cette page.",
                addToCart: "Ajouter au Panier",
                notEnoughStock: "Stock insuffisant disponible",
                outOfStock: "En rupture de stock",
                pleaseLoginToViewOrders: "Veuillez vous connecter pour voir vos commandes",
                pleaseLoginToCheckout: "Veuillez vous connecter pour procéder au paiement",
                cartEmpty: "Votre panier est vide",
                passwordsDontMatch: "Les mots de passe ne correspondent pas",
                productDetails: "Détails du Produit",
                bookDetails: "Détails du Livre",
                viewDetails: "Voir Détails",
                readBook: "Lire le Livre",
                order: "Commande",
                cancelOrder: "Annuler Commande",
                cancelOrderConfirm: "Êtes-vous sûr de vouloir annuler cette commande?",
                orderCancelled: "La commande a été annulée",
                processing: "En traitement",
                shipped: "Expédié",
                delivered: "Livré",
                cancelled: "Annulé",
                status: "Statut:",
                quantity: "Quantité:",
                inStock: "En Stock",
                lowStock: "Stock Faible",
                outOfStock: "En Rupture",
                author: "Auteur:",
                pages: "Pages:",
                published: "Publié:",
                description: "Description:",
                chapters: "Chapitres:",
                readNow: "Lire Maintenant",
                closeBook: "Fermer le Livre",
                startReading: "Commencer à Lire",
                previousPage: "Précédent",
                nextPage: "Suivant",
                aboutTitle: "À propos de Phi Sam KO",
                aboutSubtitle: "Découvrez la Beauté et l'Esprit du Cambodge",
                ourMission: "Notre Mission",
                missionText: "Phi Sam KO est dédié à la préservation et à la promotion du riche patrimoine culturel du Cambodge à travers nos produits de beauté premium et notre sagesse spirituelle. Nous combinons les connaissances traditionnelles cambodgiennes avec des techniques modernes pour vous offrir des expériences authentiques.",
                nervesCollection: "Collection de Nerfs Cambodgiens",
                nervesText: "Le Cambodge abrite un système unique de médecine traditionnelle qui reconnaît 1 336 nerfs dans le corps humain. Ces nerfs sont au cœur des pratiques de guérison traditionnelles et sont profondément liés aux croyances spirituelles.",
                nerve: "Nerf",
                location: "Emplacement",
                function: "Fonction",
                traditionalUse: "Utilisation Traditionnelle",
                page: "Page"
            }
        };
        
        // DOM Elements
        const pages = {
            home: document.getElementById('home-page'),
            products: document.getElementById('products-page'),
            library: document.getElementById('library-page'),
            cart: document.getElementById('cart-page'),
            orders: document.getElementById('orders-page'),
            about: document.getElementById('about-page'),
            login: document.getElementById('login-page'),
            register: document.getElementById('register-page'),
            checkout: document.getElementById('checkout-page')
        };
        
        const navLinks = document.querySelectorAll('.nav-link');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const checkoutForm = document.getElementById('checkoutForm');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('searchBtn');
        const searchResults = document.getElementById('searchResults');
        const productsSearchInput = document.getElementById('products-search-input');
        const productsSearchBtn = document.getElementById('products-search-btn');
        const productsSearchResults = document.getElementById('products-search-results');
        const librarySearchInput = document.getElementById('library-search-input');
        const librarySearchBtn = document.getElementById('library-search-btn');
        const librarySearchResults = document.getElementById('library-search-results');
        const categoryFilter = document.getElementById('category-filter');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartSummary = document.getElementById('cart-summary');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const languageBtn = document.getElementById('languageBtn');
        const languageDropdown = document.getElementById('languageDropdown');
        const authBackground = document.getElementById('authBackground');
        const bookCover = document.getElementById('bookCover');
        const bookPage = document.getElementById('bookPage');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const pageNumber = document.getElementById('pageNumber');
        const nervesGallery = document.getElementById('nervesGallery');
        const prevNervePageBtn = document.getElementById('prevPageBtn');
        const nextNervePageBtn = document.getElementById('nextPageBtn');
        const pageInfo = document.getElementById('pageInfo');
        
        // Initialize the application
        function init() {
            // Load sample data
            loadSampleData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Show home page by default
            navigateTo('home');
            
            // Check if user is logged in from localStorage
            checkAuthStatus();
            
            // Update UI based on authentication status
            updateAuthUI();
            
            // Load translations for current language
            updateTranslations();
            
            // Show auth background if user is not logged in
            if (!currentUser) {
                authBackground.classList.remove('hidden');
            }
        }
        
        // Load sample data with makeup, jewelry, women's products, and Buddhist books
        function loadSampleData() {
            // Generate beauty-related categories
            categories = [
                { id: 1, name: { en: 'Makeup', es: 'Maquillaje', fr: 'Maquillage' } },
                { id: 2, name: { en: 'Skincare', es: 'Cuidado de la Piel', fr: 'Soins de la Peau' } },
                { id: 3, name: { en: 'Body Jewelry', es: 'Joyería Corporal', fr: 'Bijoux Corporels' } },
                { id: 4, name: { en: 'Hair Care', es: 'Cuidado del Cabello', fr: 'Soins Capillaires' } },
                { id: 5, name: { en: 'Fragrances', es: 'Fragancias', fr: 'Parfums' } },
                { id: 6, name: { en: 'Nail Care', es: 'Cuidado de Uñas', fr: 'Soins des Ongles' } },
                { id: 7, name: { en: 'Bath & Body', es: 'Baño y Cuerpo', fr: 'Bain et Corps' } },
                { id: 8, name: { en: 'Accessories', es: 'Accesorios', fr: 'Accessoires' } },
                { id: 9, name: { en: 'Luxury Beauty', es: 'Belleza de Lujo', fr: 'Beauté de Luxe' } },
                { id: 10, name: { en: 'Natural Products', es: 'Productos Naturales', fr: 'Produits Naturels' } }
            ];
            
            // Generate 1000 beauty-related products
            products = [];
            const makeupBrands = ['L\'Oréal', 'Maybelline', 'MAC', 'Fenty', 'NARS', 'Estée Lauder', 'Clinique', 'Urban Decay', 'Too Faced', 'Huda Beauty'];
            const jewelryTypes = ['Nose Ring', 'Belly Ring', 'Ear Cuff', 'Septum Ring', 'Cartilage Stud', 'Navel Ring', 'Tragus Ring', 'Industrial Bar', 'Conch Ring', 'Helix Ring'];
            const skincareTypes = ['Cleanser', 'Moisturizer', 'Serum', 'Toner', 'Exfoliator', 'Mask', 'Eye Cream', 'Sunscreen', 'Treatment', 'Essence'];
            const hairTypes = ['Shampoo', 'Conditioner', 'Mask', 'Oil', 'Serum', 'Spray', 'Gel', 'Mousse', 'Wax', 'Pomade'];
            
            for (let i = 1; i <= 1000; i++) {
                const category = categories[Math.floor(Math.random() * categories.length)];
                const price = (Math.random() * 100 + 5).toFixed(2);
                const stock = Math.floor(Math.random() * 100);
                
                let productName = '';
                let productDesc = '';
                
                // Generate product names based on category
                if (category.id === 1) { // Makeup
                    const type = ['Foundation', 'Concealer', 'Blush', 'Highlighter', 'Eyeshadow', 'Mascara', 'Lipstick', 'Eyeliner', 'Bronzer', 'Setting Spray'][Math.floor(Math.random() * 10)];
                    const brand = makeupBrands[Math.floor(Math.random() * makeupBrands.length)];
                    productName = `${brand} ${type}`;
                    productDesc = `Premium ${type.toLowerCase()} from ${brand} for a flawless look`;
                } 
                else if (category.id === 3) { // Body Jewelry
                    const type = jewelryTypes[Math.floor(Math.random() * jewelryTypes.length)];
                    const material = ['Gold', 'Silver', 'Surgical Steel', 'Titanium', 'Rose Gold'][Math.floor(Math.random() * 5)];
                    productName = `${material} ${type}`;
                    productDesc = `Elegant ${type.toLowerCase()} made from high-quality ${material.toLowerCase()}`;
                }
                else if (category.id === 2) { // Skincare
                    const type = skincareTypes[Math.floor(Math.random() * skincareTypes.length)];
                    const brand = ['CeraVe', 'The Ordinary', 'La Roche-Posay', 'Neutrogena', 'Paula\'s Choice'][Math.floor(Math.random() * 5)];
                    productName = `${brand} ${type}`;
                    productDesc = `Effective ${type.toLowerCase()} for your skincare routine by ${brand}`;
                }
                else if (category.id === 4) { // Hair Care
                    const type = hairTypes[Math.floor(Math.random() * hairTypes.length)];
                    const brand = ['Olaplex', 'Moroccanoil', 'Briogeo', 'Redken', 'Pureology'][Math.floor(Math.random() * 5)];
                    productName = `${brand} ${type}`;
                    productDesc = `Professional ${type.toLowerCase()} for healthy hair by ${brand}`;
                }
                else {
                    // Generic product for other categories
                    productName = `Premium ${category.name.en} Product ${i}`;
                    productDesc = `High-quality ${category.name.en.toLowerCase()} product for your beauty needs`;
                }
                
                products.push({
                    id: i,
                    name: {
                        en: productName,
                        es: productName, // In a real app, these would be proper translations
                        fr: productName
                    },
                    description: {
                        en: productDesc,
                        es: productDesc,
                        fr: productDesc
                    },
                    price: parseFloat(price),
                    categoryId: category.id,
                    stock: stock,
                    image: `https://picsum.photos/200/200?random=${i}&category=beauty`
                });
            }
            
            // Generate 100 Buddhist books with more detailed content
            books = [];
            const buddhistAuthors = [
                "Thich Nhat Hanh", "Dalai Lama", "Pema Chödrön", "Shunryu Suzuki", 
                "Jack Kornfield", "Ajahn Chah", "S.N. Goenka", "D.T. Suzuki", 
                "Buddhadasa Bhikkhu", "Bhante Henepola Gunaratana"
            ];
            
            const buddhistTopics = [
                "Mindfulness", "Meditation", "Compassion", "Wisdom", 
                "The Four Noble Truths", "The Eightfold Path", "Zen", 
                "Theravada", "Mahayana", "Vajrayana", "Loving-Kindness", 
                "Impermanence", "Non-Attachment", "Enlightenment", "Karma"
            ];
            
            for (let i = 1; i <= 100; i++) {
                const author = buddhistAuthors[Math.floor(Math.random() * buddhistAuthors.length)];
                const topic = buddhistTopics[Math.floor(Math.random() * buddhistTopics.length)];
                const pages = Math.floor(Math.random() * 300) + 100;
                const year = Math.floor(Math.random() * 50) + 1970;
                
                books.push({
                    id: i,
                    title: {
                        en: `${topic}: A Buddhist Perspective`,
                        es: `${topic}: Una Perspectiva Budista`,
                        fr: `${topic}: Une Perspective Bouddhiste`
                    },
                    author: author,
                    description: {
                        en: `This profound book by ${author} explores the concept of ${topic.toLowerCase()} from a Buddhist perspective, offering practical wisdom for daily life.`,
                        es: `Este profundo libro de ${author} explora el concepto de ${topic.toLowerCase()} desde una perspectiva budista, ofreciendo sabiduría práctica para la vida diaria.`,
                        fr: `Ce livre profond de ${author} explore le concept de ${topic.toLowerCase()} d'une perspective bouddhiste, offrant une sagesse pratique pour la vie quotidienne.`
                    },
                    pages: pages,
                    year: year,
                    chapters: Math.floor(Math.floor(pages / 20)),
                    content: {
                        en: generateBookContent("en", topic, author),
                        es: generateBookContent("es", topic, author),
                        fr: generateBookContent("fr", topic, author)
                    },
                    coverImage: `https://picsum.photos/200/300?random=${i + 1000}&grayscale`
                });
            }
            
            // Generate 1336 Cambodian nerves data
            nerves = [];
            const nerveLocations = [
                "Head", "Neck", "Shoulder", "Arm", "Elbow", "Forearm", "Wrist", 
                "Hand", "Finger", "Chest", "Abdomen", "Back", "Hip", "Thigh", 
                "Knee", "Calf", "Ankle", "Foot", "Toe", "Spine", "Face", "Ear", 
                "Eye", "Nose", "Mouth", "Tongue", "Jaw", "Pelvis", "Buttock"
            ];
            
            const nerveFunctions = [
                "Sensory", "Motor", "Mixed", "Autonomic", "Sympathetic", 
                "Parasympathetic", "Proprioceptive", "Nociceptive", 
                "Thermoreceptive", "Mechanoreceptive", "Chemoreceptive"
            ];
            
            const traditionalUses = [
                "Pain relief", "Energy flow", "Spiritual connection", 
                "Healing", "Balance", "Meditation focus", "Massage therapy", 
                "Acupuncture", "Reflexology", "Ayurvedic treatment", 
                "Traditional medicine", "Energy healing"
            ];
            
            for (let i = 1; i <= 1336; i++) {
                const location = nerveLocations[Math.floor(Math.random() * nerveLocations.length)];
                const func = nerveFunctions[Math.floor(Math.random() * nerveFunctions.length)];
                const use = traditionalUses[Math.floor(Math.random() * traditionalUses.length)];
                
                nerves.push({
                    id: i,
                    name: {
                        en: `Cambodian Nerve ${i}`,
                        es: `Nervio Camboyano ${i}`,
                        fr: `Nerf Cambodgien ${i}`
                    },
                    location: {
                        en: location,
                        es: location, // In a real app, these would be proper translations
                        fr: location
                    },
                    function: {
                        en: func,
                        es: func,
                        fr: func
                    },
                    traditionalUse: {
                        en: use,
                        es: use,
                        fr: use
                    },
                    image: `https://picsum.photos/300/200?random=${i + 2000}&category=health`
                });
            }
            
            // Load cart from localStorage
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
            
            // Load orders from localStorage
            const savedOrders = localStorage.getItem('orders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            }
        }
        
        // Generate book content with more detailed chapters
        function generateBookContent(lang, topic, author) {
            const chapters = [];
            const chapterCount = Math.floor(Math.random() * 10) + 5;
            
            for (let i = 1; i <= chapterCount; i++) {
                let chapterTitle = "";
                let chapterContent = "";
                
                if (lang === "en") {
                    chapterTitle = `Chapter ${i}: ${topic} and ${i === 1 ? "the Nature of Mind" : i === 2 ? "Daily Practice" : i === 3 ? "Compassion" : "Wisdom"}`;
                    
                    // Generate more detailed content for each chapter
                    const paragraphs = [
                        `In this chapter, ${author} explores the deep connection between ${topic.toLowerCase()} and ${i === 1 ? "the fundamental nature of mind and consciousness" : i === 2 ? "how to incorporate these teachings into daily practice" : i === 3 ? "the cultivation of compassion and loving-kindness" : "the development of wisdom and understanding"}.`,
                        `The teachings presented here are drawn from ancient Buddhist scriptures as well as ${author}'s own extensive experience in teaching and practice.`,
                        `Practical exercises are provided to help readers apply these concepts in their own lives, with step-by-step guidance on ${i === 1 ? "observing the nature of thoughts" : i === 2 ? "establishing a daily meditation routine" : i === 3 ? "cultivating loving-kindness towards oneself and others" : "developing insight into the nature of reality"}.`,
                        `${author} shares personal anecdotes and stories from the Buddhist tradition that illustrate the transformative power of ${topic.toLowerCase()}.`,
                        `The chapter concludes with reflections on how these teachings can be integrated into modern life, addressing common challenges and misconceptions about ${topic.toLowerCase()}.`
                    ];
                    
                    chapterContent = paragraphs.join('\n\n');
                } else if (lang === "es") {
                    chapterTitle = `Capítulo ${i}: ${topic} y ${i === 1 ? "la Naturaleza de la Mente" : i === 2 ? "Práctica Diaria" : i === 3 ? "Compasión" : "Sabiduría"}`;
                    
                    const paragraphs = [
                        `En este capítulo, ${author} explora la profunda conexión entre ${topic.toLowerCase()} y ${i === 1 ? "la naturaleza fundamental de la mente y la conciencia" : i === 2 ? "cómo incorporar estas enseñanzas en la práctica diaria" : i === 3 ? "el cultivo de la compasión y la bondad amorosa" : "el desarrollo de la sabiduría y la comprensión"}.`,
                        `Las enseñanzas presentadas aquí se extraen de las antiguas escrituras budistas, así como de la amplia experiencia de ${author} en la enseñanza y la práctica.`,
                        `Se proporcionan ejercicios prácticos para ayudar a los lectores a aplicar estos conceptos en sus propias vidas, con orientación paso a paso sobre ${i === 1 ? "observar la naturaleza de los pensamientos" : i === 2 ? "establecer una rutina diaria de meditación" : i === 3 ? "cultivar la bondad amorosa hacia uno mismo y hacia los demás" : "desarrollar una visión de la naturaleza de la realidad"}.`,
                        `${author} comparte anécdotas personales e historias de la tradición budista que ilustran el poder transformador de ${topic.toLowerCase()}.`,
                        `El capítulo concluye con reflexiones sobre cómo estas enseñanzas pueden integrarse en la vida moderna, abordando los desafíos y conceptos erróneos comunes sobre ${topic.toLowerCase()}.`
                    ];
                    
                    chapterContent = paragraphs.join('\n\n');
                } else if (lang === "fr") {
                    chapterTitle = `Chapitre ${i}: ${topic} et ${i === 1 ? "la Nature de l'Esprit" : i === 2 ? "Pratique Quotidienne" : i === 3 ? "Compassion" : "Sagesse"}`;
                    
                    const paragraphs = [
                        `Dans ce chapitre, ${author} explore le lien profond entre ${topic.toLowerCase()} et ${i === 1 ? "la nature fondamentale de l'esprit et de la conscience" : i === 2 ? "comment intégrer ces enseignements dans la pratique quotidienne" : i === 3 ? "la culture de la compassion et de la bienveillance" : "le développement de la sagesse et de la compréhension"}.`,
                        `Les enseignements présentés ici sont tirés des anciennes écritures bouddhistes ainsi que de la vaste expérience de ${author} dans l'enseignement et la pratique.`,
                        `Des exercices pratiques sont fournis pour aider les lecteurs à appliquer ces concepts dans leur propre vie, avec des conseils étape par étape sur ${i === 1 ? "observer la nature des pensées" : i === 2 ? "établir une routine de méditation quotidienne" : i === 3 ? "cultiver la bienveillance envers soi-même et les autres" : "développer une vision de la nature de la réalité"}.`,
                        `${author} partage des anecdotes personnelles et des histoires de la tradition bouddhiste qui illustrent le pouvoir transformateur de ${topic.toLowerCase()}.`,
                        `Le chapitre se termine par des réflexions sur la façon dont ces enseignements peuvent être intégrés dans la vie moderne, en abordant les défis et les idées fausses courantes sur ${topic.toLowerCase()}.`
                    ];
                    
                    chapterContent = paragraphs.join('\n\n');
                }
                
                chapters.push({
                    title: chapterTitle,
                    content: chapterContent
                });
            }
            
            return chapters;
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    
                    // Check if user needs to be logged in for this page
                    if (['cart', 'orders', 'checkout'].includes(page) && !currentUser) {
                        openModal('authRequiredModal');
                        return;
                    }
                    
                    navigateTo(page);
                });
            });
            
            // Auth buttons
            loginBtn.addEventListener('click', () => navigateTo('login'));
            registerBtn.addEventListener('click', () => navigateTo('register'));
            logoutBtn.addEventListener('click', logout);
            
            // Forms
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            checkoutForm.addEventListener('submit', handleCheckout);
            
            // Search functionality
            searchInput.addEventListener('input', () => performSearch(searchInput.value, searchResults));
            searchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                performSearch(searchInput.value, searchResults);
            });
            
            productsSearchInput.addEventListener('input', () => performSearch(productsSearchInput.value, productsSearchResults));
            productsSearchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                performSearch(productsSearchInput.value, productsSearchResults);
            });
            
            librarySearchInput.addEventListener('input', () => performLibrarySearch(librarySearchInput.value, librarySearchResults));
            librarySearchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                performLibrarySearch(librarySearchInput.value, librarySearchResults);
            });
            
            // Close search results when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.classList.remove('show');
                }
                if (!productsSearchInput.contains(e.target) && !productsSearchResults.contains(e.target)) {
                    productsSearchResults.classList.remove('show');
                }
                if (!librarySearchInput.contains(e.target) && !librarySearchResults.contains(e.target)) {
                    librarySearchResults.classList.remove('show');
                }
            });
            
            // Category filter
            categoryFilter.addEventListener('change', filterProducts);
            
            // Checkout button
            checkoutBtn.addEventListener('click', () => {
                if (!currentUser) {
                    openModal('authRequiredModal');
                    return;
                }
                navigateTo('checkout');
            });
            
            // Language selector
            languageBtn.addEventListener('click', toggleLanguageDropdown);
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', changeLanguage);
            });
            
            // Book reader controls
            prevPageBtn.addEventListener('click', goToPreviousPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            
            // Nerves pagination
            prevNervePageBtn.addEventListener('click', () => {
                if (currentNervePage > 1) {
                    currentNervePage--;
                    loadNerves();
                }
            });
            
            nextNervePageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(nerves.length / nervesPerPage);
                if (currentNervePage < totalPages) {
                    currentNervePage++;
                    loadNerves();
                }
            });
        }
        
        // Perform search and show results
        function performSearch(query, resultsContainer) {
            if (!query.trim()) {
                resultsContainer.classList.remove('show');
                return;
            }
            
            const searchTerm = query.toLowerCase();
            const matchedProducts = products.filter(product => 
                product.name[currentLanguage].toLowerCase().includes(searchTerm) || 
                product.description[currentLanguage].toLowerCase().includes(searchTerm)
            ).slice(0, 5); // Show top 5 results
            
            if (matchedProducts.length === 0) {
                resultsContainer.innerHTML = `<div class="search-result-item">No results found</div>`;
            } else {
                resultsContainer.innerHTML = matchedProducts.map(product => `
                    <div class="search-result-item" data-id="${product.id}">
                        <div><strong>${product.name[currentLanguage]}</strong></div>
                        <div>$${product.price.toFixed(2)}</div>
                    </div>
                `).join('');
                
                // Add click event to search results
                resultsContainer.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const productId = parseInt(item.getAttribute('data-id'));
                        showProductDetail(productId);
                        resultsContainer.classList.remove('show');
                    });
                });
            }
            
            resultsContainer.classList.add('show');
        }
        
        // Perform library search
        function performLibrarySearch(query, resultsContainer) {
            if (!query.trim()) {
                resultsContainer.classList.remove('show');
                return;
            }
            
            const searchTerm = query.toLowerCase();
            const matchedBooks = books.filter(book => 
                book.title[currentLanguage].toLowerCase().includes(searchTerm) || 
                book.author.toLowerCase().includes(searchTerm) ||
                book.description[currentLanguage].toLowerCase().includes(searchTerm)
            ).slice(0, 5); // Show top 5 results
            
            if (matchedBooks.length === 0) {
                resultsContainer.innerHTML = `<div class="search-result-item">No results found</div>`;
            } else {
                resultsContainer.innerHTML = matchedBooks.map(book => `
                    <div class="search-result-item" data-id="${book.id}">
                        <div><strong>${book.title[currentLanguage]}</strong></div>
                        <div>by ${book.author}</div>
                    </div>
                `).join('');
                
                // Add click event to search results
                resultsContainer.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const bookId = parseInt(item.getAttribute('data-id'));
                        showBookDetail(bookId);
                        resultsContainer.classList.remove('show');
                    });
                });
            }
            
            resultsContainer.classList.add('show');
        }
        
        // Navigation function
        function navigateTo(page) {
            // Hide all pages
            Object.values(pages).forEach(p => {
                p.classList.add('hidden');
            });
            
            // Show the selected page
            pages[page].classList.remove('hidden');
            
            // Update active nav link
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });
            
            // Load content for the page
            switch (page) {
                case 'home':
                    loadFeaturedProducts();
                    break;
                case 'products':
                    loadAllProducts();
                    loadCategories();
                    break;
                case 'library':
                    loadLibraryBooks();
                    break;
                case 'cart':
                    loadCart();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'about':
                    loadNerves();
                    break;
                case 'checkout':
                    loadCheckoutItems();
                    break;
            }
        }
        
        // Load featured products (8 random products)
        function loadFeaturedProducts() {
            const featuredContainer = pages.home.querySelector('.products-grid');
            featuredContainer.innerHTML = '';
            
            // Get 8 random products
            const shuffled = [...products].sort(() => 0.5 - Math.random());
            const featuredProducts = shuffled.slice(0, 8);
            
            featuredProducts.forEach(product => {
                featuredContainer.appendChild(createProductCard(product, true));
            });
        }
        
        // Load all products
        function loadAllProducts() {
            const productsContainer = pages.products.querySelector('.products-grid');
            productsContainer.innerHTML = '';
            
            products.forEach(product => {
                productsContainer.appendChild(createProductCard(product, false));
            });
        }
        
        // Load library books
        function loadLibraryBooks() {
            const libraryContainer = pages.library.querySelector('.library-list');
            libraryContainer.innerHTML = '';
            
            books.forEach(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'library-card';
                bookCard.dataset.id = book.id;
                
                bookCard.innerHTML = `
                    <h3>${book.title[currentLanguage]}</h3>
                    <p class="author">${translations[currentLanguage].author} ${book.author}</p>
                    <p>${book.description[currentLanguage]}</p>
                    <p>${translations[currentLanguage].pages}: ${book.pages} | ${translations[currentLanguage].published}: ${book.year}</p>
                    <button class="read-btn">${translations[currentLanguage].readBook}</button>
                `;
                
                // Add event listener to read button
                const readBtn = bookCard.querySelector('.read-btn');
                readBtn.addEventListener('click', () => openBookReader(book.id));
                
                libraryContainer.appendChild(bookCard);
            });
        }
        
        // Load nerves with pagination
        function loadNerves() {
            nervesGallery.innerHTML = '';
            
            const startIndex = (currentNervePage - 1) * nervesPerPage;
            const endIndex = startIndex + nervesPerPage;
            const nervesToShow = nerves.slice(startIndex, endIndex);
            
            nervesToShow.forEach(nerve => {
                const nerveCard = document.createElement('div');
                nerveCard.className = 'nerve-card';
                
                nerveCard.innerHTML = `
                    <div class="nerve-image">
                        <img src="${nerve.image}" alt="${nerve.name[currentLanguage]}">
                    </div>
                    <div class="nerve-info">
                        <div class="nerve-name">${nerve.name[currentLanguage]}</div>
                        <div><strong>${translations[currentLanguage].location}:</strong> ${nerve.location[currentLanguage]}</div>
                        <div><strong>${translations[currentLanguage].function}:</strong> ${nerve.function[currentLanguage]}</div>
                        <div><strong>${translations[currentLanguage].traditionalUse}:</strong> ${nerve.traditionalUse[currentLanguage]}</div>
                    </div>
                `;
                
                nervesGallery.appendChild(nerveCard);
            });
            
            // Update pagination info
            const totalPages = Math.ceil(nerves.length / nervesPerPage);
            pageInfo.textContent = `${translations[currentLanguage].page} ${currentNervePage} ${translations[currentLanguage].of} ${totalPages}`;
            
            // Update pagination buttons
            prevNervePageBtn.disabled = currentNervePage <= 1;
            nextNervePageBtn.disabled = currentNervePage >= totalPages;
        }
        
        // Create product card element
        function createProductCard(product, isFeatured) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.id = product.id;
            card.dataset.category = product.categoryId;
            
            const stockStatus = getStockStatus(product.stock);
            
            card.innerHTML = `
                <div class="product-image">
                    <img src="${product.image}" alt="${product.name[currentLanguage]}">
                </div>
                <div class="product-info">
                    <h3 class="product-title">${product.name[currentLanguage]}</h3>
                    <div class="product-price">$${product.price.toFixed(2)}</div>
                    <div class="product-stock ${stockStatus.class}">${stockStatus.text[currentLanguage]}</div>
                    <div class="product-actions">
                        <button class="add-to-cart" ${product.stock === 0 ? 'disabled' : ''}>
                            ${translations[currentLanguage].addToCart}
                        </button>
                        <button class="wishlist-btn">♥</button>
                    </div>
                    ${isFeatured ? `<button class="view-details-btn">${translations[currentLanguage].viewDetails}</button>` : ''}
                </div>
            `;
            
            // Add event listeners
            const addToCartBtn = card.querySelector('.add-to-cart');
            addToCartBtn.addEventListener('click', () => addToCart(product.id));
            
            const wishlistBtn = card.querySelector('.wishlist-btn');
            wishlistBtn.addEventListener('click', () => {
                wishlistBtn.classList.toggle('active');
            });
            
            if (isFeatured) {
                const viewDetailsBtn = card.querySelector('.view-details-btn');
                viewDetailsBtn.addEventListener('click', () => showProductDetail(product.id));
            }
            
            // Make entire card clickable to view details (except for buttons)
            card.addEventListener('click', (e) => {
                if (!e.target.closest('button')) {
                    showProductDetail(product.id);
                }
            });
            
            return card;
        }
        
        // Show product detail modal
        function showProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const category = categories.find(c => c.id === product.categoryId);
            const stockStatus = getStockStatus(product.stock);
            
            document.getElementById('productDetailContent').innerHTML = `
                <div class="product-detail-image">
                    <img src="${product.image}" alt="${product.name[currentLanguage]}">
                </div>
                <div class="product-detail-info">
                    <h2 class="product-detail-title">${product.name[currentLanguage]}</h2>
                    <div class="product-detail-price">$${product.price.toFixed(2)}</div>
                    ${category ? `<div class="product-detail-category">${translations[currentLanguage].category}: ${category.name[currentLanguage]}</div>` : ''}
                    <div class="product-detail-stock ${stockStatus.class}">
                        ${translations[currentLanguage].status}: ${stockStatus.text[currentLanguage]}
                    </div>
                    <div class="product-detail-description">
                        <h4>${translations[currentLanguage].description}:</h4>
                        <p>${product.description[currentLanguage]}</p>
                    </div>
                    <div class="product-detail-actions">
                        <button class="add-to-cart" ${product.stock === 0 ? 'disabled' : ''}>
                            ${translations[currentLanguage].addToCart}
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to add to cart button in modal
            const modalAddToCartBtn = document.querySelector('#productDetailContent .add-to-cart');
            modalAddToCartBtn.addEventListener('click', () => {
                addToCart(product.id);
                closeModal('productDetailModal');
            });
            
            openModal('productDetailModal');
        }
        
        // Show book detail modal
        function showBookDetail(bookId) {
            const book = books.find(b => b.id === bookId);
            if (!book) return;
            
            document.getElementById('bookDetailContent').innerHTML = `
                <div class="book-cover-preview">
                    <img src="${book.coverImage}" alt="${book.title[currentLanguage]}">
                </div>
                <div class="book-content-preview">
                    <h2>${book.title[currentLanguage]}</h2>
                    <p class="author">${translations[currentLanguage].author} ${book.author}</p>
                    <p>${translations[currentLanguage].pages}: ${book.pages} | ${translations[currentLanguage].published}: ${book.year}</p>
                    <div class="description">
                        <h4>${translations[currentLanguage].description}</h4>
                        <p>${book.description[currentLanguage]}</p>
                    </div>
                    <div class="chapters">
                        <h4>${translations[currentLanguage].chapters} (${book.chapters})</h4>
                        ${book.content[currentLanguage].slice(0, 3).map(chapter => `
                            <div class="chapter">
                                <h3>${chapter.title}</h3>
                                <p>${chapter.content.split('\n\n')[0]}</p>
                            </div>
                        `).join('')}
                    </div>
                    <button class="read-btn" style="margin-top: auto;">${translations[currentLanguage].readNow}</button>
                </div>
            `;
            
            // Add event listener to read button
            const readBtn = document.querySelector('#bookDetailContent .read-btn');
            readBtn.addEventListener('click', () => {
                openBookReader(book.id);
                closeModal('bookDetailModal');
            });
            
            openModal('bookDetailModal');
        }
        
        // Open book reader with the selected book
        function openBookReader(bookId) {
            currentBook = books.find(b => b.id === bookId);
            if (!currentBook) return;
            
            currentPage = 0;
            
            // Set up book cover
            bookCover.innerHTML = `
                <img src="${currentBook.coverImage}" alt="${currentBook.title[currentLanguage]}">
                <h2>${currentBook.title[currentLanguage]}</h2>
                <p class="author">${translations[currentLanguage].author} ${currentBook.author}</p>
                <button class="start-reading">${translations[currentLanguage].startReading}</button>
            `;
            
            // Add event listener to start reading button
            const startReadingBtn = bookCover.querySelector('.start-reading');
            startReadingBtn.addEventListener('click', () => {
                loadBookPage(0);
                bookCover.style.transform = 'rotateY(-180deg)';
            });
            
            // Load first page
            loadBookPage(0);
            
            // Update controls
            updateBookControls();
            
            // Open modal
            openModal('bookReaderModal');
        }
        
        // Load a specific page of the book
        function loadBookPage(pageIndex) {
            if (!currentBook || pageIndex < 0 || pageIndex >= currentBook.content[currentLanguage].length) return;
            
            currentPage = pageIndex;
            const chapter = currentBook.content[currentLanguage][pageIndex];
            
            bookPage.innerHTML = `
                <h3>${chapter.title}</h3>
                ${chapter.content.split('\n\n').map(para => `<p>${para}</p>`).join('')}
            `;
            
            // Update page number display
            pageNumber.textContent = `${currentPage + 1}/${currentBook.content[currentLanguage].length}`;
            
            // Update controls
            updateBookControls();
        }
        
        // Update book reader controls (previous/next buttons)
        function updateBookControls() {
            prevPageBtn.disabled = currentPage <= 0;
            nextPageBtn.disabled = currentPage >= currentBook.content[currentLanguage].length - 1;
            
            // Update button text with translations
            prevPageBtn.textContent = translations[currentLanguage].previousPage;
            nextPageBtn.textContent = translations[currentLanguage].nextPage;
        }
        
        // Go to previous page
        function goToPreviousPage() {
            if (currentPage > 0) {
                loadBookPage(currentPage - 1);
            }
        }
        
        // Go to next page
        function goToNextPage() {
            if (currentPage < currentBook.content[currentLanguage].length - 1) {
                loadBookPage(currentPage + 1);
            }
        }
        
        // Get stock status
        function getStockStatus(stock) {
            if (stock > 20) {
                return {
                    class: 'in-stock',
                    text: {
                        en: translations[currentLanguage].inStock,
                        es: translations[currentLanguage].inStock,
                        fr: translations[currentLanguage].inStock
                    }
                };
            } else if (stock > 0) {
                return {
                    class: 'low-stock',
                    text: {
                        en: `${translations[currentLanguage].lowStock} (${stock} left)`,
                        es: `${translations[currentLanguage].lowStock} (${stock} restantes)`,
                        fr: `${translations[currentLanguage].lowStock} (${stock} restants)`
                    }
                };
            } else {
                return {
                    class: 'out-of-stock',
                    text: {
                        en: translations[currentLanguage].outOfStock,
                        es: translations[currentLanguage].outOfStock,
                        fr: translations[currentLanguage].outOfStock
                    }
                };
            }
        }
        
        // Load categories for filter
        function loadCategories() {
            categoryFilter.innerHTML = '';
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = translations[currentLanguage].allCategories;
            categoryFilter.appendChild(defaultOption);
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name[currentLanguage];
                categoryFilter.appendChild(option);
            });
        }
        
        // Filter products based on search and category
        function filterProducts() {
            const searchTerm = productsSearchInput.value.toLowerCase();
            const categoryId = categoryFilter.value;
            
            const filteredProducts = products.filter(product => {
                const matchesSearch = product.name[currentLanguage].toLowerCase().includes(searchTerm) || 
                                    product.description[currentLanguage].toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryId || product.categoryId.toString() === categoryId;
                
                return matchesSearch && matchesCategory;
            });
            
            const productsContainer = pages.products.querySelector('.products-grid');
            productsContainer.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                productsContainer.innerHTML = `<p class="text-center">No products found matching your criteria</p>`;
            } else {
                filteredProducts.forEach(product => {
                    productsContainer.appendChild(createProductCard(product, false));
                });
            }
        }
        
        // Cart functions
        function addToCart(productId) {
            if (!currentUser) {
                openModal('authRequiredModal');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Check if product is already in cart
            const existingItem = cart.find(item => item.productId === productId);
            
            if (existingItem) {
                // Check stock availability
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity += 1;
                } else {
                    alert(translations[currentLanguage].notEnoughStock);
                    return;
                }
            } else {
                // Add new item to cart
                cart.push({
                    productId: product.id,
                    quantity: 1,
                    price: product.price
                });
            }
            
            // Save cart to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update cart UI
            if (pages.cart.classList.contains('hidden')) {
                // Show notification or update cart count
            } else {
                loadCart();
            }
        }
        
        function loadCart() {
            const cartItemsContainer = pages.cart.querySelector('.cart-items');
            const emptyCartMessage = pages.cart.querySelector('#empty-cart-message');
            const cartSummary = pages.cart.querySelector('#cart-summary');
            
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                cartSummary.classList.add('hidden');
                cartItemsContainer.innerHTML = '';
                return;
            }
            
            emptyCartMessage.classList.add('hidden');
            cartSummary.classList.remove('hidden');
            
            // Clear existing items
            cartItemsContainer.innerHTML = '';
            
            let subtotal = 0;
            
            cart.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                
                if (!product) return;
                
                const itemTotal = item.quantity * item.price;
                subtotal += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.dataset.id = product.id;
                
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        <img src="${product.image}" alt="${product.name[currentLanguage]}">
                    </div>
                    <div class="cart-item-details">
                        <h4 class="cart-item-title">${product.name[currentLanguage]}</h4>
                        <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                    </div>
                    <div class="cart-item-actions">
                        <div class="quantity-control">
                            <button class="quantity-btn minus">-</button>
                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="${product.stock}">
                            <button class="quantity-btn plus">+</button>
                        </div>
                        <button class="remove-item">×</button>
                    </div>
                `;
                
                // Add event listeners
                const minusBtn = cartItem.querySelector('.minus');
                const plusBtn = cartItem.querySelector('.plus');
                const quantityInput = cartItem.querySelector('.quantity-input');
                const removeBtn = cartItem.querySelector('.remove-item');
                
                minusBtn.addEventListener('click', () => updateCartItemQuantity(product.id, parseInt(quantityInput.value) - 1));
                plusBtn.addEventListener('click', () => updateCartItemQuantity(product.id, parseInt(quantityInput.value) + 1));
                quantityInput.addEventListener('change', () => updateCartItemQuantity(product.id, parseInt(quantityInput.value)));
                removeBtn.addEventListener('click', () => removeFromCart(product.id));
                
                cartItemsContainer.appendChild(cartItem);
            });
            
            // Calculate totals
            const shipping = 5.99;
            const tax = subtotal * 0.1; // 10% tax
            const total = subtotal + shipping + tax;
            
            // Update summary
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('shipping').textContent = `$${shipping.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        }
        
        function updateCartItemQuantity(productId, newQuantity) {
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            if (newQuantity < 1) {
                removeFromCart(productId);
                return;
            }
            
            if (newQuantity > product.stock) {
                alert(translations[currentLanguage].notEnoughStock);
                return;
            }
            
            const itemIndex = cart.findIndex(item => item.productId === productId);
            
            if (itemIndex !== -1) {
                cart[itemIndex].quantity = newQuantity;
                localStorage.setItem('cart', JSON.stringify(cart));
                loadCart();
            }
        }
        
        function removeFromCart(productId) {
            cart = cart.filter(item => item.productId !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }
        
        // Order functions
        function loadOrders() {
            const ordersContainer = pages.orders.querySelector('.orders-list');
            const noOrdersMessage = pages.orders.querySelector('#no-orders-message');
            
            if (!currentUser) {
                noOrdersMessage.textContent = translations[currentLanguage].pleaseLoginToViewOrders;
                noOrdersMessage.classList.remove('hidden');
                ordersContainer.innerHTML = '';
                return;
            }
            
            const userOrders = orders.filter(order => order.userId === currentUser.id);
            
            if (userOrders.length === 0) {
                noOrdersMessage.textContent = translations[currentLanguage].noOrders;
                noOrdersMessage.classList.remove('hidden');
                ordersContainer.innerHTML = '';
                return;
            }
            
            noOrdersMessage.classList.add('hidden');
            ordersContainer.innerHTML = '';
            
            userOrders.forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = 'order-card';
                
                // Determine status class
                let statusClass = '';
                if (order.status === 'Processing') statusClass = 'processing';
                else if (order.status === 'Shipped') statusClass = 'shipped';
                else if (order.status === 'Delivered') statusClass = 'delivered';
                else if (order.status === 'Cancelled') statusClass = 'cancelled';
                
                orderElement.innerHTML = `
                    <div class="order-header">
                        <h3>${translations[currentLanguage].order} #${order.id}</h3>
                        <span class="order-date">${new Date(order.date).toLocaleDateString()}</span>
                    </div>
                    <div class="order-status ${statusClass}">${order.status}</div>
                    <div class="order-total">${translations[currentLanguage].total}: $${order.total.toFixed(2)}</div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div class="order-item">
                                <span>${item.name} × ${item.quantity}</span>
                                <span>$${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="order-actions">
                        ${order.status === 'Processing' ? 
                            `<button class="cancel-order-btn" data-order-id="${order.id}">
                                ${translations[currentLanguage].cancelOrder}
                            </button>` : ''}
                    </div>
                `;
                
                // Add cancel order event listener if applicable
                if (order.status === 'Processing') {
                    const cancelBtn = orderElement.querySelector('.cancel-order-btn');
                    cancelBtn.addEventListener('click', () => cancelOrder(order.id));
                }
                
                ordersContainer.appendChild(orderElement);
            });
        }
        
        function cancelOrder(orderId) {
            if (!confirm(translations[currentLanguage].cancelOrderConfirm)) {
                return;
            }
            
            const orderIndex = orders.findIndex(order => order.id === orderId && order.userId === currentUser.id);
            
            if (orderIndex !== -1) {
                // Update order status
                orders[orderIndex].status = 'Cancelled';
                localStorage.setItem('orders', JSON.stringify(orders));
                
                // Return items to stock (in a real app, this would be more complex)
                orders[orderIndex].items.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        product.stock += item.quantity;
                    }
                });
                
                // Reload orders
                loadOrders();
                
                alert(translations[currentLanguage].orderCancelled);
            }
        }
        
        // Authentication functions
        function checkAuthStatus() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
            }
        }
        
        function updateAuthUI() {
            if (currentUser) {
                loginBtn.classList.add('hidden');
                registerBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                
                // Update nav to show user-specific items
            } else {
                loginBtn.classList.remove('hidden');
                registerBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // In a real app, this would be a server request
            // For demo purposes, we'll just create a user
            currentUser = {
                id: 1,
                name: 'Beauty Shopper',
                email: email
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateAuthUI();
            
            // Hide auth background
            document.getElementById('authBackground').classList.add('hidden');
            
            // Close login form and go to home
            navigateTo('home');
        }
        
        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (password !== confirmPassword) {
                alert(translations[currentLanguage].passwordsDontMatch);
                return;
            }
            
            // In a real app, this would be a server request
            currentUser = {
                id: Date.now(),
                name: name,
                email: email
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateAuthUI();
            
            // Hide auth background
            document.getElementById('authBackground').classList.add('hidden');
            
            // Close register form and go to home
            navigateTo('home');
        }
        
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateAuthUI();
            navigateTo('home');
            
            // Show auth background again
            document.getElementById('authBackground').classList.remove('hidden');
        }
        
        // Checkout functions
        function handleCheckout(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert(translations[currentLanguage].pleaseLoginToCheckout);
                navigateTo('login');
                return;
            }
            
            if (cart.length === 0) {
                alert(translations[currentLanguage].cartEmpty);
                return;
            }
            
            const name = document.getElementById('checkout-name').value;
            const email = document.getElementById('checkout-email').value;
            const address = document.getElementById('checkout-address').value;
            const paymentMethod = document.getElementById('checkout-payment').value;
            
            // Calculate order total
            let subtotal = 0;
            cart.forEach(item => {
                subtotal += item.quantity * item.price;
            });
            
            const shipping = 5.99;
            const tax = subtotal * 0.1; // 10% tax
            const total = subtotal + shipping + tax;
            
            // Create order
            const order = {
                id: Date.now(),
                userId: currentUser.id,
                date: new Date().toISOString(),
                status: 'Processing',
                items: cart.map(item => {
                    const product = products.find(p => p.id === item.productId);
                    return {
                        productId: product.id,
                        name: product.name[currentLanguage],
                        price: product.price,
                        quantity: item.quantity
                    };
                }),
                shippingAddress: address,
                paymentMethod: paymentMethod,
                subtotal: subtotal,
                shipping: shipping,
                tax: tax,
                total: total
            };
            
            // Add to orders
            orders.push(order);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Clear cart
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Show confirmation
            document.getElementById('confirmation-order-id').textContent = order.id;
            document.getElementById('confirmation-order-total').textContent = `$${order.total.toFixed(2)}`;
            openModal('orderConfirmationModal');
        }
        
        function loadCheckoutItems() {
            const checkoutItemsContainer = document.getElementById('checkout-items');
            checkoutItemsContainer.innerHTML = '';
            
            let subtotal = 0;
            
            cart.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                
                if (!product) return;
                
                const itemTotal = item.quantity * item.price;
                subtotal += itemTotal;
                
                const itemElement = document.createElement('div');
                itemElement.className = 'summary-row';
                itemElement.innerHTML = `
                    <span>${product.name[currentLanguage]} × ${item.quantity}</span>
                    <span>$${itemTotal.toFixed(2)}</span>
                `;
                
                checkoutItemsContainer.appendChild(itemElement);
            });
            
            // Calculate totals
            const shipping = 5.99;
            const tax = subtotal * 0.1; // 10% tax
            const total = subtotal + shipping + tax;
            
            // Update summary
            document.getElementById('checkout-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('checkout-shipping').textContent = `$${shipping.toFixed(2)}`;
            document.getElementById('checkout-tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('checkout-total').textContent = `$${total.toFixed(2)}`;
            
            // Pre-fill user info if logged in
            if (currentUser) {
                document.getElementById('checkout-name').value = currentUser.name;
                document.getElementById('checkout-email').value = currentUser.email;
            }
        }
        
        // Modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
            
            if (modalId === 'bookReaderModal') {
                // Reset book cover position when opening
                bookCover.style.transform = 'rotateY(0deg)';
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }
        
        // Language functions
        function toggleLanguageDropdown() {
            languageDropdown.classList.toggle('show');
        }
        
        function changeLanguage(e) {
            const lang = e.target.getAttribute('data-lang');
            currentLanguage = lang;
            languageBtn.textContent = lang.toUpperCase();
            languageDropdown.classList.remove('show');
            
            // Update translations
            updateTranslations();
            
            // Reload current page content
            const currentPage = document.querySelector('.page-content:not(.hidden)').id.replace('-page', '');
            navigateTo(currentPage);
            
            // Update book reader if open
            if (currentBook && document.getElementById('bookReaderModal').style.display === 'flex') {
                openBookReader(currentBook.id);
            }
        }
        
        function updateTranslations() {
            // Update static text elements
            document.querySelector('#home-page h1').textContent = translations[currentLanguage].welcome;
            document.querySelector('#home-page p').textContent = translations[currentLanguage].description;
            document.querySelector('#products-page h1').textContent = translations[currentLanguage].productsTitle;
            document.querySelector('#products-page p').textContent = translations[currentLanguage].productsDescription;
            document.querySelector('#library-page h1').textContent = translations[currentLanguage].libraryTitle;
            document.querySelector('#library-page p').textContent = translations[currentLanguage].libraryDescription;
            document.querySelector('#cart-page h1').textContent = translations[currentLanguage].cartTitle;
            document.querySelector('#empty-cart-message p').textContent = translations[currentLanguage].emptyCart;
            document.querySelector('#empty-cart-message button').textContent = translations[currentLanguage].browseProducts;
            document.querySelector('#no-orders-message p').textContent = translations[currentLanguage].noOrders;
            document.querySelector('#no-orders-message button').textContent = translations[currentLanguage].browseProducts;
            document.querySelector('#login-page .form-title').textContent = translations[currentLanguage].loginTitle;
            document.querySelector('#register-page .form-title').textContent = translations[currentLanguage].registerTitle;
            document.querySelector('#checkout-page .form-title').textContent = translations[currentLanguage].checkoutTitle;
            document.querySelector('#orderConfirmationModal .modal-title').textContent = translations[currentLanguage].orderConfirmation;
            document.querySelector('#orderConfirmationModal h3').textContent = translations[currentLanguage].thankYou;
            document.querySelector('#orderConfirmationModal p:nth-of-type(1)').textContent = translations[currentLanguage].orderPlaced;
            document.querySelector('#orderConfirmationModal p:nth-of-type(2)').textContent = translations[currentLanguage].orderId;
            document.querySelector('#orderConfirmationModal button').textContent = translations[currentLanguage].viewOrders;
            document.querySelector('#authRequiredModal .modal-title').textContent = translations[currentLanguage].authRequired;
            document.querySelector('#authRequiredModal h3').textContent = translations[currentLanguage].authRequired;
            document.querySelector('#authRequiredModal p').textContent = translations[currentLanguage].authRequiredMessage;
            document.querySelector('#productDetailModal .modal-title').textContent = translations[currentLanguage].productDetails;
            document.querySelector('#bookDetailModal .modal-title').textContent = translations[currentLanguage].bookDetails;
            document.querySelector('#bookReaderModal .modal-title').textContent = translations[currentLanguage].bookDetails;
            document.querySelector('#about-page .about-header h1').textContent = translations[currentLanguage].aboutTitle;
            document.querySelector('#about-page .about-header p').textContent = translations[currentLanguage].aboutSubtitle;
            document.querySelector('#about-page .about-content h2:nth-of-type(1)').textContent = translations[currentLanguage].ourMission;
            document.querySelector('#about-page .about-content p:nth-of-type(1)').textContent = translations[currentLanguage].missionText;
            document.querySelector('#about-page .about-content h2:nth-of-type(2)').textContent = translations[currentLanguage].nervesCollection;
            document.querySelector('#about-page .about-content p:nth-of-type(2)').textContent = translations[currentLanguage].nervesText;
            
            // Update form labels
            document.querySelector('label[for="login-email"]').textContent = translations[currentLanguage].email;
            document.querySelector('label[for="login-password"]').textContent = translations[currentLanguage].password;
            document.querySelector('#loginForm button').textContent = translations[currentLanguage].login;
            document.querySelector('#login-page .form-footer p').innerHTML = `${translations[currentLanguage].dontHaveAccount} <a href="#" onclick="navigateTo('register')">${translations[currentLanguage].register}</a>`;
            
            document.querySelector('label[for="register-name"]').textContent = translations[currentLanguage].fullName;
            document.querySelector('label[for="register-email"]').textContent = translations[currentLanguage].email;
            document.querySelector('label[for="register-password"]').textContent = translations[currentLanguage].password;
            document.querySelector('label[for="register-confirm-password"]').textContent = translations[currentLanguage].confirmPassword;
            document.querySelector('#registerForm button').textContent = translations[currentLanguage].register;
            document.querySelector('#register-page .form-footer p').innerHTML = `${translations[currentLanguage].alreadyHaveAccount} <a href="#" onclick="navigateTo('login')">${translations[currentLanguage].login}</a>`;
            
            document.querySelector('label[for="checkout-name"]').textContent = translations[currentLanguage].fullName;
            document.querySelector('label[for="checkout-email"]').textContent = translations[currentLanguage].email;
            document.querySelector('label[for="checkout-address"]').textContent = translations[currentLanguage].shippingAddress;
            document.querySelector('label[for="checkout-payment"]').textContent = translations[currentLanguage].paymentMethod;
            document.querySelector('#checkout-payment option[value=""]').textContent = translations[currentLanguage].selectPayment;
            document.querySelector('#checkout-payment option[value="credit"]').textContent = translations[currentLanguage].creditCard;
            document.querySelector('#checkout-payment option[value="paypal"]').textContent = translations[currentLanguage].paypal;
            document.querySelector('#checkout-payment option[value="bank"]').textContent = translations[currentLanguage].bankTransfer;
            document.querySelector('#checkoutForm button').textContent = translations[currentLanguage].placeOrder;
            document.querySelector('#checkout-page .order-summary h3').textContent = translations[currentLanguage].orderSummary;
            
            // Update summary labels
            document.querySelectorAll('.summary-row span:first-child').forEach(span => {
                if (span.textContent.includes('Subtotal')) span.textContent = translations[currentLanguage].subtotal;
                else if (span.textContent.includes('Shipping')) span.textContent = translations[currentLanguage].shipping;
                else if (span.textContent.includes('Tax')) span.textContent = translations[currentLanguage].tax;
                else if (span.textContent.includes('Total')) span.textContent = translations[currentLanguage].total;
            });
            
            // Update category filter
            if (categoryFilter.firstChild) {
                categoryFilter.firstChild.textContent = translations[currentLanguage].allCategories;
            }
            
            // Update library books if on library page
            if (!pages.library.classList.contains('hidden')) {
                loadLibraryBooks();
            }
            
            // Update nerves if on about page
            if (!pages.about.classList.contains('hidden')) {
                loadNerves();
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>